<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0050)http://archlinuxarm.org/forum/viewtopic.php?t=7253 -->
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<meta http-equiv="content-style-type" content="text/css">
<meta http-equiv="content-language" content="en-gb">
<meta http-equiv="imagetoolbar" content="no">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="copyright" content="2000, 2002, 2005, 2007 phpBB Group">
<meta name="keywords" content="">
<meta name="description" content="">
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7; IE=EmulateIE9">

<title>Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept</title>

<!--
	phpBB style name: SimpleCorp
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:      Awesome Styles ( http://www.awesomestyles.com )
	
	NOTE: This page was generated by phpBB, the free open-source bulletin board package.
	      The phpBB Group is not responsible for the content of this page and forum. For more information
	      about phpBB please visit http://www.phpbb.com
-->
<link rel="alternate" type="application/atom+xml" title="Feed - Arch Linux ARM" href="http://archlinuxarm.org/forum/feed.php">
<script async="" src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/analytics.js"></script><script type="text/javascript">
// <![CDATA[
	var jump_page = 'Enter the page number you wish to go to:';
	var on_page = '1';
	var per_page = '';
	var base_url = '';
	var style_cookie = 'phpBBstyle';
	var style_cookie_settings = '; path=/; domain=archlinuxarm.org';
	var onload_functions = new Array();
	var onunload_functions = new Array();

	

	/**
	* Find a member
	*/
	function find_username(url)
	{
		popup(url, 760, 570, '_usersearch');
		return false;
	}

	/**
	* New function for handling multiple calls to window.onload and window.unload by pentapenguin
	*/
	window.onload = function()
	{
		for (var i = 0; i < onload_functions.length; i++)
		{
			eval(onload_functions[i]);
		}
	}

	window.onunload = function()
	{
		for (var i = 0; i < onunload_functions.length; i++)
		{
			eval(onunload_functions[i]);
		}
	}

// ]]>
</script>
<script type="text/javascript" src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/styleswitcher.js"></script>
<script type="text/javascript" src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/forum_fn.js"></script>


<link href="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/print.css" rel="stylesheet" type="text/css" media="print" title="printonly" disabled="">
<link href="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/style.php" rel="stylesheet" type="text/css" media="screen, projection">

<link href="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/normal.css" rel="stylesheet" type="text/css" title="A" disabled="">
<link href="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/medium.css" rel="alternate stylesheet" type="text/css" title="A+" disabled="">
<link href="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/large.css" rel="alternate stylesheet" type="text/css" title="A++" disabled="">



</head>

<body id="phpbb" class="section-viewtopic ltr">
<div class="wrapper">
	<div class="top">
		<div class="header">
			<h1><a href="http://archlinuxarm.org/forum/index.php?sid=4db29ae4c7a1f0826ed1b8839ca2b944" title="Board index"><img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/ALARM-2.png"></a></h1>
			<h2></h2>
			<div class="clear"></div>
		</div>
		<div class="menu">
			<ul>	
            
                               <li><a href="http://archlinuxarm.org/forum" title="Forum Home">Forum Home</a></li>
                    
				
				
				
				<li><a href="http://archlinuxarm.org/forum/faq.php?sid=4db29ae4c7a1f0826ed1b8839ca2b944" title="Frequently Asked Questions">FAQ</a></li>
				
				
					<li><a href="http://archlinuxarm.org/forum/search.php?sid=4db29ae4c7a1f0826ed1b8839ca2b944">Search</a></li>
				
						<li><a href="http://archlinuxarm.org/forum/ucp.php?mode=register&sid=4db29ae4c7a1f0826ed1b8839ca2b944">Register</a></li>
					
				
					<li><a href="http://archlinuxarm.org/forum/ucp.php?mode=login&sid=4db29ae4c7a1f0826ed1b8839ca2b944" title="Login" accesskey="x">Login</a></li>
				
				
			</ul>
		</div>
	</div>		
		<div class="navbar">
			<div class="inner">
			<ul class="linklist navlinks">
				<li class="icon-home"><a href="http://archlinuxarm.org/forum/index.php?sid=4db29ae4c7a1f0826ed1b8839ca2b944" accesskey="h">Board index</a>  <strong>‹</strong> <a href="http://archlinuxarm.org/forum/viewforum.php?f=39&sid=4db29ae4c7a1f0826ed1b8839ca2b944">Hardware</a> <strong>‹</strong> <a href="http://archlinuxarm.org/forum/viewforum.php?f=40&sid=4db29ae4c7a1f0826ed1b8839ca2b944">ARMv7 Devices</a> <strong>‹</strong> <a href="http://archlinuxarm.org/forum/viewforum.php?f=33&sid=4db29ae4c7a1f0826ed1b8839ca2b944">Allwinner</a></li>

			
			</ul>




			</div>
		</div>



	<a name="start_here"></a>
	<div id="page-body">
		
		 
<h2><a href="http://archlinuxarm.org/forum/viewtopic.php?f=33&t=7253&sid=4db29ae4c7a1f0826ed1b8839ca2b944">Got bluetooth working on Cubietruck - proof of concept</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body --><div style="display: none !important;">This forum is for supported devices using an ARMv7 Allwinner SoC.<br></div>

<div class="topic-actions">

	<div class="buttons">
	
		<div class="locked-icon"><a href="http://archlinuxarm.org/forum/posting.php?mode=reply&f=33&t=7253&sid=4db29ae4c7a1f0826ed1b8839ca2b944" title="This topic is locked, you cannot edit posts or make further replies."><span></span>Topic locked</a></div>
	
	</div>

	
		<div class="search-box">
			<form method="post" id="topic-search" action="http://archlinuxarm.org/forum/search.php?sid=4db29ae4c7a1f0826ed1b8839ca2b944">
			<fieldset>
				<input class="inputbox search tiny" type="text" name="keywords" id="search_keywords" size="20" value="Search this topic…" onclick="if(this.value==&#39;Search this topic…&#39;)this.value=&#39;&#39;;" onblur="if(this.value==&#39;&#39;)this.value=&#39;Search this topic…&#39;;">
				<input class="button2" type="submit" value="Search">
				<input type="hidden" value="7253" name="t">
				<input type="hidden" value="msgonly" name="sf">
			</fieldset>
			</form>
		</div>
	
		<div class="pagination">
			6 posts
			 • Page <strong>1</strong> of <strong>1</strong>
		</div>
	

</div>
<div class="clear"></div>


	<div id="p39808" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 class="first"><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#p39808">Got bluetooth working on Cubietruck - proof of concept</a></h3>
			<p class="author"><a href="http://archlinuxarm.org/forum/viewtopic.php?p=39808&sid=4db29ae4c7a1f0826ed1b8839ca2b944#p39808"><img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_post_target.gif" width="11" height="9" alt="Post" title="Post"></a>by <strong><a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a></strong> » Fri May 16, 2014 8:57 pm </p>

			

			<div class="content">In order to get bluetooth to work you first need to get ttyS1 to work. <br>The problem here is that the current kernel allows for only one uart and ttyS0 is already in use for debug terminal<br>recompiling the kernel with <br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>CONFIG_SERIAL_8250_NR_UARTS=2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>CONFIG_SERIAL_8250_RUNTIME_UARTS=2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br></code></dd></dl><br>instead of 1 solves that problem. ttyS1 is now available:<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>[&nbsp; &nbsp; 1.465217] [uart]: serial probe 2 irq 35 mapbase 0x01c28800&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>[&nbsp; &nbsp; 1.497099] sunxi-uart.2: ttyS1 at MMIO 0x1c28800 (irq = 35) is a U6_16550A&nbsp; <br></code></dd></dl><br>then preload the following modules:<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>bluetooth&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>hidp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>rfcomm&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>bnep&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>hci_uart&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br></code></dd></dl><br>in /etc/modules-load.d/bluetooth.conf.<br><br>then get the broadcom patchram plus utility here:<br><!-- m --><a class="postlink" href="https://broadcom-bluetooth.googlecode.com/archive/53e35d81e01aaa3472c70e9f4295094cb851d9ab.tar.gz">https://broadcom-bluetooth.googlecode.c ... 9ab.tar.gz</a><!-- m --><br><br>unpack and compile (just type make)<br>then (assuming you already have the firmware ap6210 in /usr/lib/firmware)<br>go read this page: <a href="http://linux-sunxi.org/Cubietruck/Bluetooth" class="postlink">http://linux-sunxi.org/Cubietruck/Bluetooth</a><br><br>now type<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>sudo systemctl start bluetooth<br></code></dd></dl><br><br>now type  as root in the patchram directory (or put in your path somewhere)<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>./brcm_patchram_plus -d&nbsp; --patchram /lib/firmware/ap6210/bcm20710a1.hcd --enable_hci --bd_addr 11:22:33:44:55:66 --no2bytes --tosleep 1000 /dev/ttyS1</code></dd></dl><br> I always need to Ctrl-C and do it again to make it work. The console goes dead, leave it be (Work for later...)<br><br>Open a second console and type <br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>sudo bluetoothctrl<br></code></dd></dl>you see your controller appear.<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>[NEW] Controller 11:22:33:44:55:66 cubie [default]<br>[bluetooth]# show&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Controller 11:22:33:44:55:66&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; Name: cubie&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; Alias: cubie&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; Class: 0x000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; Powered: no&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; Discoverable: no&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; Pairable: yes&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; UUID: PnP Information&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(...)&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; UUID: Generic Access Profile&nbsp; &nbsp; (...)&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; UUID: Generic Attribute Profile (...)&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; UUID: A/V Remote Control&nbsp; &nbsp; &nbsp; &nbsp; (...)&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; UUID: A/V Remote Control Target (...)&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; Modalias: usb:...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; Discovering: no&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>[bluetooth]# </code></dd></dl><br>your bluetooth is working.<br><br>This is a proof of concept within the ARCH environment. There is more work to be done. <br><br>fave fun<br><br>LP</div>

			

		</div>

		
			<dl class="postprofile" id="profile39808">
			<dt>
				<a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 120</dd><dd><strong>Joined:</strong> Mon Jun 10, 2013 6:52 am</dd>

		</dl>
	

		<div class="back2top"><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider">

	<div id="p39810" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#p39810">Re: Got bluetooth working on Cubietruck - proof of concept</a></h3>
			<p class="author"><a href="http://archlinuxarm.org/forum/viewtopic.php?p=39810&sid=4db29ae4c7a1f0826ed1b8839ca2b944#p39810"><img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_post_target.gif" width="11" height="9" alt="Post" title="Post"></a>by <strong><a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=383&sid=4db29ae4c7a1f0826ed1b8839ca2b944" style="color: #00AA00;" class="username-coloured">WarheadsSE</a></strong> » Fri May 16, 2014 8:59 pm </p>

			

			<div class="content">Nicely done.</div>

			<div id="sig39810" class="signature"><span style="font-style: italic">Core Developer</span><br>Remember: Arch Linux ARM is <span style="font-weight: bold">entirely</span>  <a href="http://archlinuxarm.org/donate" class="postlink">community donation</a> supported!</div>

		</div>

		
			<dl class="postprofile" id="profile39810">
			<dt>
				<a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=383&sid=4db29ae4c7a1f0826ed1b8839ca2b944" style="color: #00AA00;" class="username-coloured">WarheadsSE</a>
			</dt>

			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 5630</dd><dd><strong>Joined:</strong> Mon Oct 18, 2010 2:12 pm</dd>

		</dl>
	

		<div class="back2top"><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider">

	<div id="p39812" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#p39812">Re: Got bluetooth working on Cubietruck - proof of concept</a></h3>
			<p class="author"><a href="http://archlinuxarm.org/forum/viewtopic.php?p=39812&sid=4db29ae4c7a1f0826ed1b8839ca2b944#p39812"><img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_post_target.gif" width="11" height="9" alt="Post" title="Post"></a>by <strong><a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=128&sid=4db29ae4c7a1f0826ed1b8839ca2b944" style="color: #00AA00;" class="username-coloured">pepedog</a></strong> » Fri May 16, 2014 10:48 pm </p>

			

			<div class="content">Similar hardware by Broadcom packaged here<br><!-- m --><a class="postlink" href="https://github.com/archlinuxarm/PKGBUILDs/tree/master/alarm/firmware-brcm43xx">https://github.com/archlinuxarm/PKGBUIL ... e-brcm43xx</a><!-- m --><br>Uses patchram too and might be an easy to adapt thing? Note it covers 2 chipsets</div>

			

		</div>

		
			<dl class="postprofile" id="profile39812">
			<dt>
				<a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=128&sid=4db29ae4c7a1f0826ed1b8839ca2b944" style="color: #00AA00;" class="username-coloured">pepedog</a>
			</dt>

			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2402</dd><dd><strong>Joined:</strong> Mon Jun 07, 2010 3:30 pm</dd><dd><strong>Location:</strong> London UK</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://myplugbox.com/" title="WWW: http://myplugbox.com/"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider">

	<div id="p39815" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#p39815">Re: Got bluetooth working on Cubietruck - proof of concept</a></h3>
			<p class="author"><a href="http://archlinuxarm.org/forum/viewtopic.php?p=39815&sid=4db29ae4c7a1f0826ed1b8839ca2b944#p39815"><img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_post_target.gif" width="11" height="9" alt="Post" title="Post"></a>by <strong><a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a></strong> » Sat May 17, 2014 7:24 am </p>

			

			<div class="content">looks promising. I think I can make that working.<br><br>I guess I finally have to figure out how to use git in the right way <img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_e_smile.gif" alt=":-)" title="Smile"><br><br>LP</div>

			

		</div>

		
			<dl class="postprofile" id="profile39815">
			<dt>
				<a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 120</dd><dd><strong>Joined:</strong> Mon Jun 10, 2013 6:52 am</dd>

		</dl>
	

		<div class="back2top"><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider">

	<div id="p39843" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#p39843">Re: Got bluetooth working on Cubietruck - proof of concept</a></h3>
			<p class="author"><a href="http://archlinuxarm.org/forum/viewtopic.php?p=39843&sid=4db29ae4c7a1f0826ed1b8839ca2b944#p39843"><img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_post_target.gif" width="11" height="9" alt="Post" title="Post"></a>by <strong><a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a></strong> » Sun May 18, 2014 10:50 am </p>

			

			<div class="content">pepedog, thanks a million for the pointer You've done most of the work already.<br><br>Adapting the scripts was a breeze, but two problems remain:<br><br>First I always needed to start the patchram program twice. The first time it halts on the first reset command to the broadcom chip. I found a workaround for it, but it is ugly. <br><br>I send <br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>echo -e "\x01\x03\x0c\x00" &gt; /dev/ttyS1<br></code></dd></dl><br>before the patchram command. This is the first reset command, which is ignored, but it simulates the unsuccessful first startup. And it works. Zarkwon knows why. If somebody knows where to find the loader protocol I'm interested.<br>I left the patchram program unmodified. <br><br>Second I have not located the chip ident in the /sys directory yet. So I can't check for a valid install.<br><br>EDIT: belay that, I'm using /sys/class/rfkill/*/name. One of them is the chip ident. One problem left to solve<br><br>Nevertheless, progress <img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_e_smile.gif" alt=":-)" title="Smile"><br><br>LP</div>

			

		</div>

		
			<dl class="postprofile" id="profile39843">
			<dt>
				<a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 120</dd><dd><strong>Joined:</strong> Mon Jun 10, 2013 6:52 am</dd>

		</dl>
	

		<div class="back2top"><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider">

	<div id="p39885" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#p39885">Re: Got bluetooth working on Cubietruck - proof of concept</a></h3>
			<p class="author"><a href="http://archlinuxarm.org/forum/viewtopic.php?p=39885&sid=4db29ae4c7a1f0826ed1b8839ca2b944#p39885"><img src="./Arch Linux ARM • View topic - Got bluetooth working on Cubietruck - proof of concept_files/icon_post_target.gif" width="11" height="9" alt="Post" title="Post"></a>by <strong><a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a></strong> » Tue May 20, 2014 10:49 am </p>

			

			<div class="content">I think I know what happens. <br>On booting the Cubietruck the RTS of UART-2 is set high<br>Running patchram pulls RTS low when starting, but fails to transfer data. Closing the program leaves RTS low<br><br>Issuing the command <dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>echo -n "" &gt; /dev/ttyS1</code></dd></dl> also pulls RTS low and leaves it low.<br><br>running patchram when RTS is initially low completes without problems.<br><br>External triggering of RTS also made patchram perform as expected.<br><br>I'm not clear on  the underlying problem. There is some mention of a mandatory 8 clock cycle delay after setting the divisor latch registers in the UART in the A20 user manual, but just inserting a delay in patchram did not work. There are probably several ways to approach this, but I think that issuing the above command is the least invasive, so I'm inclined to leave it at that.<br><br>Conclusion: The Cubietruck bluetooth works, with available tools, drivers and firmware. Required is a Kernel config modification to enable the second UART, a systemd service and a startup script.<br><br>For who is interested:<br>Patchram can be obtained by installing the firmware-brcm43xx package.<br><br>the bcm40183 firmware is here: <!-- m --><a class="postlink" href="http://dl.cubieforums.com/patwood/ap6210.zip">http://dl.cubieforums.com/patwood/ap6210.zip</a><!-- m --><br>it goes in /usr/lib/firmware<br><br>and  these are the scripts, with thanks to pepedog, for doing most of the work:<br><br>/usr/lib/systemd/system/brcm40183.service<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>[Unit]<br>Description=Load Broadcom bluetooth firmware<br>Before=bluetooth.service<br><br>[Service]<br>EnvironmentFile=/etc/conf.d/bcm40183<br>Type=oneshot<br>ExecStart=/usr/lib/systemd/scripts/start-brcm40183-patchram-plus<br>RemainAfterExit=yes<br><br>[Install]<br>WantedBy=multi-user.target<br></code></dd></dl><br>/usr/lib/systemd/scripts/start-brcm40183-patchram-plus<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>#!/bin/sh<br><br>MAC_OPTIONS=""<br>if [ -z "$MAC_ADDR" ]; then<br>&nbsp; &nbsp;echo "MAC_ADDR in /etc/conf.d/bcm40183 not set, will use MAC set by device (expect this to be buggy)"<br>else<br>&nbsp; &nbsp;MAC_OPTIONS="--bd_addr $MAC_ADDR"<br>fi<br><br># Selection for CubieTruck (CubieBoard 3)<br>if [ -n "$(cat /sys/class/rfkill/*/name | grep bcm40183)" ]; then <br>&nbsp; PORT=$(ls /sys/devices/platform/sunxi-uart.2/tty/)<br>&nbsp; echo -en "" &gt; /dev/$PORT&nbsp; &nbsp;&nbsp; &nbsp;# pull down RTS on UART<br>&nbsp; HCD="ap6210/bcm20710a1.hcd"<br>&nbsp; EXTRA="--no2bytes --tosleep=1000"<br>&nbsp; /usr/bin/brcm_patchram_plus --patchram /usr/lib/firmware/$HCD --enable_hci $EXTRA $MAC_OPTIONS /dev/$PORT &amp;<br>else<br>&nbsp; echo " No device Found."<br>&nbsp; exit 1<br>fi<br><br>for i in 1 2 3 4 5 ; do<br>&nbsp; b=$(hciconfig | grep UART | cut -d: -f1)<br>&nbsp; if [ -n "$b" ] ; then<br>&nbsp; &nbsp; hciconfig $b up <br>&nbsp; &nbsp; break<br>&nbsp; else <br>&nbsp; &nbsp; sleep $i<br>&nbsp; fi<br>done<br><br>exit 0<br></code></dd></dl><br><br>and optional: /etc/conf.d/bcm40183, modify to taste<br><dl class="codebox"><dt>Code: <a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>MAC_ADDR=43:29:B1:55:01:01<br></code></dd></dl><br><br>be well... <br>LP</div>

			

		</div>

		
			<dl class="postprofile" id="profile39885">
			<dt>
				<a href="http://archlinuxarm.org/forum/memberlist.php?mode=viewprofile&u=13011&sid=4db29ae4c7a1f0826ed1b8839ca2b944">PLyttle</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 120</dd><dd><strong>Joined:</strong> Mon Jun 10, 2013 6:52 am</dd>

		</dl>
	

		<div class="back2top"><a href="http://archlinuxarm.org/forum/viewtopic.php?t=7253#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider">

	<form id="viewtopic" method="post" action="http://archlinuxarm.org/forum/viewtopic.php?f=33&t=7253&sid=4db29ae4c7a1f0826ed1b8839ca2b944">

	<fieldset class="display-options" style="margin-top: 0; ">
		
		<label>Display posts from previous: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
		<label>Sort by <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label> <label><select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select> <input type="submit" name="sort" value="Go" class="button2"></label>
		
	</fieldset>

	</form>
	<hr>


<div class="topic-actions">
	<div class="buttons">
	
		<div class="locked-icon"><a href="http://archlinuxarm.org/forum/posting.php?mode=reply&f=33&t=7253&sid=4db29ae4c7a1f0826ed1b8839ca2b944" title="This topic is locked, you cannot edit posts or make further replies."><span></span>Topic locked</a></div>
	
	</div>

	
		<div class="pagination">
			6 posts
			 • Page <strong>1</strong> of <strong>1</strong>
		</div>
	
</div>


	<p></p><p><a href="http://archlinuxarm.org/forum/viewforum.php?f=33&sid=4db29ae4c7a1f0826ed1b8839ca2b944" class="left-box left" accesskey="r">Return to Allwinner</a></p>

	<form method="post" id="jumpbox" action="http://archlinuxarm.org/forum/viewforum.php?sid=4db29ae4c7a1f0826ed1b8839ca2b944" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	
		<fieldset class="jumpbox">
	
			<label for="f" accesskey="j">Jump to:</label>
			<select name="f" id="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms[&#39;jumpbox&#39;].submit() }">
			
				<option value="-1">Select a forum</option>
			<option value="-1">------------------</option>
				<option value="11">Arch Linux ARM</option>
			
				<option value="3">&nbsp; &nbsp;Announcements</option>
			
				<option value="8">&nbsp; &nbsp;Community</option>
			
				<option value="30">&nbsp; &nbsp;Community Guides</option>
			
				<option value="9">&nbsp; &nbsp;User Questions</option>
			
				<option value="14">&nbsp; &nbsp;Home</option>
			
				<option value="32">&nbsp; &nbsp;Bug Reports and Feature Requests</option>
			
				<option value="38">&nbsp; &nbsp;Reviews</option>
			
				<option value="56">Software</option>
			
				<option value="57">&nbsp; &nbsp;General</option>
			
				<option value="58">&nbsp; &nbsp;ARMv5</option>
			
				<option value="59">&nbsp; &nbsp;ARMv6h</option>
			
				<option value="60">&nbsp; &nbsp;ARMv7h</option>
			
				<option value="39">Hardware</option>
			
				<option value="42">&nbsp; &nbsp;ARMv5 Devices</option>
			
				<option value="52">&nbsp; &nbsp;&nbsp; &nbsp;Freescale i.MX233</option>
			
				<option value="54">&nbsp; &nbsp;&nbsp; &nbsp;Marvell Armada 310</option>
			
				<option value="53">&nbsp; &nbsp;&nbsp; &nbsp;Marvell Kirkwood</option>
			
				<option value="55">&nbsp; &nbsp;&nbsp; &nbsp;Community Supported</option>
			
				<option value="41">&nbsp; &nbsp;ARMv6 Devices</option>
			
				<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;Raspberry Pi</option>
			
				<option value="51">&nbsp; &nbsp;&nbsp; &nbsp;Community Supported</option>
			
				<option value="40">&nbsp; &nbsp;ARMv7 Devices</option>
			
				<option value="33" selected="selected">&nbsp; &nbsp;&nbsp; &nbsp;Allwinner</option>
			
				<option value="63">&nbsp; &nbsp;&nbsp; &nbsp;Amlogic</option>
			
				<option value="64">&nbsp; &nbsp;&nbsp; &nbsp;Broadcom</option>
			
				<option value="45">&nbsp; &nbsp;&nbsp; &nbsp;Freescale</option>
			
				<option value="46">&nbsp; &nbsp;&nbsp; &nbsp;Marvell</option>
			
				<option value="49">&nbsp; &nbsp;&nbsp; &nbsp;nVidia</option>
			
				<option value="47">&nbsp; &nbsp;&nbsp; &nbsp;Samsung</option>
			
				<option value="48">&nbsp; &nbsp;&nbsp; &nbsp;Texas Instruments (TI)</option>
			
				<option value="62">&nbsp; &nbsp;&nbsp; &nbsp;Xilinx</option>
			
				<option value="44">&nbsp; &nbsp;&nbsp; &nbsp;Community Supported</option>
			
				<option value="12">Development</option>
			
				<option value="7">&nbsp; &nbsp;Arch Linux ARM</option>
			
				<option value="4">&nbsp; &nbsp;User-Submitted Packages</option>
			
				<option value="6">&nbsp; &nbsp;Hardware</option>
			
				<option value="15">&nbsp; &nbsp;Packages</option>
			
				<option value="23">&nbsp; &nbsp;U-Boot/Kernel</option>
			
				<option value="5">&nbsp; &nbsp;Package Requests</option>
			
				<option value="22">Devices</option>
			
				<option value="27">&nbsp; &nbsp;[Please read announcement] Community-Supported Devices</option>
			
			</select>
			<input type="submit" value="Go" class="button2">
		</fieldset>
	</form>


	<h3>Who is online</h3>
	<p>Users browsing this forum: No registered users and 0 guests</p>
</div>

<div id="page-footer">

	<div class="navbar">
		<div class="inner">

		<ul class="linklist">
			<li class="icon-home"><a href="http://archlinuxarm.org/forum/index.php?sid=4db29ae4c7a1f0826ed1b8839ca2b944" accesskey="h">Board index</a></li>
				
			<li class="rightside"><a href="http://archlinuxarm.org/forum/memberlist.php?mode=leaders&sid=4db29ae4c7a1f0826ed1b8839ca2b944">The team</a> • <a href="http://archlinuxarm.org/forum/ucp.php?mode=delete_cookies&sid=4db29ae4c7a1f0826ed1b8839ca2b944">Delete all board cookies</a> • All times are UTC </li>
		</ul>

		</div>
	</div>
	


	<div class="debugdata">
		
	</div>
</div>

<!--
	We request you retain the full copyright notice below including the link to www.phpbb.com.
	This not only gives respect to the large amount of time given freely by the developers
	but also helps build interest, traffic and use of phpBB3. If you (honestly) cannot retain
	the full copyright we ask you at least leave in place the "Powered by phpBB" line, with
	"phpBB" linked to www.phpbb.com. If you refuse to include even this then support on our
	forums may be affected.

	The phpBB Group : 2006
//-->

	<p class="footer">Powered by <a href="http://www.phpbb.com/"><strong>phpBB</strong></a> © 2000, 2002, 2005, 2007 phpBB Group
		
		&nbsp;&nbsp; © YourWebsiteName. Original Design: <a href="http://www.spyka.net/"><strong>Free CSS Templates</strong></a>. phpBB3 port by  <a href="http://www.awesomestyles.com/"><strong>phpBB3 styles</strong></a> 
	</p>
</div>

<div>
	<a id="bottom" name="bottom" accesskey="z"></a>
	
</div>
	


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-24579207-1', 'auto');
ga('send', 'pageview');

</script>

</body></html>